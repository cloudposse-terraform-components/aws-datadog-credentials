name: "aws-datadog-credentials"
# Canonical GitHub repo
github_repo: "cloudposse-terraform-components/aws-datadog-credentials"
# Short description of this project
description: |-
  This component is responsible for provisioning SSM or ASM entries for Datadog API keys.

  It's required that the DataDog API and APP secret keys are available in the `var.datadog_secrets_source_store_account`
  account in AWS SSM Parameter Store at the `/datadog/%v/datadog_app_key` paths (where `%v` are the corresponding account
  names).

  This component copies keys from the source account (e.g. `auto`) to the destination account where this is being
  deployed. The purpose of using this formatted copying of keys handles a couple of problems.

  1. The keys are needed in each account where datadog resources will be deployed.
  1. The keys might need to be different per account or tenant, or any subset of accounts.
  1. If the keys need to be rotated they can be rotated from a single management account.

  This module also has a submodule which allows other resources to quickly use it to create a datadog provider.

  See Datadog's [documentation about provisioning keys](https://docs.datadoghq.com/account_management/api-app-keys) for
  more information.

  ## Sponsorship

  <picture>
    <source media="(prefers-color-scheme: dark)" srcset="https://cloudposse.com/images/partners/datadog-white.svg">
    <source media="(prefers-color-scheme: light)" srcset="https://cloudposse.com/images/partners/datadog-purple.svg">
    <img alt="Datadog" src="https://cloudposse.com/images/partners/datadog-purple.svg" align="right" width="30%">
  </picture>


  This project is supported by the [Datadog Open Source Program](https://www.datadoghq.com/partner/open-source/).

  As part of this collaboration, Datadog generously provides a dedicated sandbox account that we use for automated integration and acceptance testing.
  This ensures all changes are continuously validated against a real Datadog environment, improving reliability and reducing the risk of regressions.

  ___

usage: |-
  **Stack Level**: Global

  > [!WARNING]
  > This is subject to change from a **Global** to a **Regional** stack level. This is because we need the keys
  > in each region where we deploy datadog resources - so that we don't need to configure extra AWS Providers (which would
  > need to be dynamic - which we cannot do). This is a limitation of Terraform.

  This component should be deployed to every account where you want to provision datadog resources. This is usually every
  account except `root` and `identity`

  Here's an example snippet for how to use this component. It's suggested to apply this component to all accounts which
  you want to track AWS metrics with DataDog. In this example we use the key paths `/datadog/%v/datadog_api_key` and
  `/datadog/%v/datadog_app_key` where `%v` is `default`, this can be changed through `datadog_app_secret_key` &
  `datadog_api_secret_key` variables. The output Keys in the deployed account will be `/datadog/datadog_api_key` and
  `/datadog/datadog_app_key`.

  ```yaml
  components:
    terraform:
      datadog-configuration:
        settings:
          spacelift:
            workspace_enabled: true
        vars:
          enabled: true
          name: datadog-configuration
          datadog_secrets_store_type: SSM
          datadog_secrets_source_store_account_stage: auto
          datadog_secrets_source_store_account_region: "us-east-2"
  ```

  Here is a snippet of using the `datadog_keys` submodule:

  ```terraform
  module "datadog_configuration" {
    source  = "../datadog-configuration/modules/datadog_keys"
    enabled = true
    context = module.this.context
  }

  provider "datadog" {
    api_key  = module.datadog_configuration.datadog_api_key
    app_key  = module.datadog_configuration.datadog_app_key
    api_url  = module.datadog_configuration.datadog_api_url
    validate = local.enabled
  }
  ```

  <!-- prettier-ignore-start -->
  <!-- prettier-ignore-end -->

references:
  - name: "Datadog's documentation about provisioning keys"
    description: ""
    url: "https://docs.datadoghq.com/account_management/api-app-keys"
  - name: cloudposse-terraform-components
    url: https://github.com/orgs/cloudposse-terraform-components/repositories
    description: "Cloud Posse's upstream component"
tags:
  - component/datadog-configuration
  - layer/datadog
  - provider/datadog
  - provider/aws
# Categories of this project
categories:
  - component/datadog-configuration
  - layer/datadog
  - provider/datadog
  - provider/aws
# License of this project
license: "APACHE2"
# Badges to display
badges:
  - name: Latest Release
    image: https://img.shields.io/github/release/cloudposse-terraform-components/aws-datadog-credentials.svg?style=for-the-badge
    url: https://github.com/cloudposse-terraform-components/aws-datadog-credentials/releases/latest
  - name: Slack Community
    image: https://slack.cloudposse.com/for-the-badge.svg
    url: https://slack.cloudposse.com
related:
  - name: "Cloud Posse Terraform Modules"
    description: Our collection of reusable Terraform modules used by our reference architectures.
    url: "https://docs.cloudposse.com/modules/"
  - name: "Atmos"
    description: "Atmos is like docker-compose but for your infrastructure"
    url: "https://atmos.tools"
contributors: [] # If included generates contribs
